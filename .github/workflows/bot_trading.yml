name: Bot de Trading Kraken (MACD)

# =========================================================
# TRIGGERS
# =========================================================
on:
  # 1. Ejecución Manual (para debugging inmediato)
  workflow_dispatch:
  
  # 2. Ejecución automática al hacer push a la rama principal
  push:
    branches:
      - main
      
  # 3. Scheduler Cron: Ejecuta el bot al inicio de cada hora (0 minutos de cada hora).
  schedule:
    - cron: '0 * * * *'

# =========================================================
# JOBS
# =========================================================
jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
      - name: 1. Checkout del Código
        uses: actions/checkout@v4

      - name: 2. Construir la Imagen Docker
        # La imagen se construye usando el Dockerfile en la raíz del repositorio
        run: docker build -t bot-trading-macd-kraken-v1 .

      - name: 3. Ejecutar Bot y Generar Señal
        # Inyecta todas las configuraciones de entorno necesarias
        run: |
          # La sintaxis 'docker run \' permite ejecutar comandos largos en varias líneas
          docker run \
          -e KRAKEN_API_KEY=${{ secrets.KRAKEN_API_KEY }} \
          -e KRAKEN_SECRET_KEY=${{ secrets.KRAKEN_SECRET_KEY }} \
          \
          # CONFIGURACIÓN DE ESTRATEGIA (Temporalidad de 1h)
          -e SYMBOL='BTC/USD' \
          -e TIMEFRAME='1h' \
          -e LIMIT='300' \
          \
          # CONFIGURACIÓN DE RIESGO (Valores por defecto en Python)
          -e RISK_PER_TRADE='0.01' \
          -e MAX_DRAWDOWN='0.05' \
          -e COOLDOWN_HOURS='24' \
          \
          # CONFIGURACIÓN DE TELEGRAM (Opcional, si se configuran los secrets)
          -e TELEGRAM_TOKEN=${{ secrets.TELEGRAM_TOKEN }} \
          -e TELEGRAM_CHAT_ID=${{ secrets.TELEGRAM_CHAT_ID }} \
          \
          # Ejecuta el script principal
          bot-trading-macd-kraken-v1 python macd_trader.py